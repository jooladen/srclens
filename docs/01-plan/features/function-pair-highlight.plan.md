# Plan: function-pair-highlight

**Feature**: 소스창에서 함수/블록 클릭 시 짝 라인 표시
**Version Target**: v0.6.0
**Created**: 2026-02-21
**Status**: Plan

---

## 1. 목적 (Why)

현재 학습 모드(LearnMode)에서 줄을 클릭하면 해당 줄의 설명이 나온다.
그런데 `function foo() {` 같은 줄을 클릭했을 때, 이 함수가 **어디서 끝나는지**(짝 `}` 가 몇 번 줄에 있는지)를 전혀 알 수 없다.

**초보자 페인 포인트**: "이 함수가 어디까지인지 모르겠어요" → 코드 구조 파악이 어렵다.

---

## 2. 기능 정의 (What)

### 2-1. 핵심 동작

학습 모드 소스창에서 줄을 클릭하면:

| 클릭한 줄 유형 | 표시 내용 |
|---|---|
| `{` 가 있는 줄 (함수/조건/반복 선언) | "이 블록은 **N번 줄**에서 닫힙니다 ↓" |
| `}` 만 있는 줄 (닫는 중괄호) | "이 블록은 **N번 줄**에서 열렸습니다 ↑" |
| `{` 와 `}` 가 같은 줄 (인라인) | 짝 표시 없음 (self-contained) |
| 일반 코드 줄 | 기존 설명만 표시 |

### 2-2. UI 표현

- 기존 설명 패널(노란 박스) 아래에 **짝 정보 줄** 추가
- 짝이 있는 줄 번호는 **클릭 가능** → 해당 줄로 스크롤 + 임시 하이라이트
- 짝 줄 번호 옆에는 방향 화살표 표시 (↓ 아래 / ↑ 위)

```
┌─────────────────────────────────────────────┐
│ 💡 'MyComponent'를 정의하고 내보냅니다...  │
│ ↔ 이 블록은 24번 줄에서 닫힙니다 [이동▼]  │
└─────────────────────────────────────────────┘
```

### 2-3. 비고

- 짝 탐색은 **오프라인 순수 파싱** (문자열 스택 방식)
- 문자열/주석 내부의 `{` `}` 는 무시
- 템플릿 리터럴(`` ` ``) 내부도 무시

---

## 3. 구현 범위 (Scope)

### 변경 파일

| 파일 | 작업 내용 |
|------|----------|
| `lib/analyzer.ts` | `findMatchingBracket(lines: string[], lineIndex: number): number \| null` 함수 추가 |
| `components/analyzer/LearnMode.tsx` | 짝 정보 표시 UI + 스크롤 이동 로직 추가 |
| `CLAUDE.md` | 버전 히스토리 v0.6.0 업데이트 |

### 변경하지 않는 것

- `types/analysis.ts` — 새 타입 불필요 (컴포넌트 내부 로컬 상태로 처리)
- `app/_components/AnalyzerClient.tsx` — 변경 없음
- 분석 결과 패널들 (ScoreCard, SuggestionsCard 등) — 변경 없음

---

## 4. 핵심 알고리즘

### findMatchingBracket 로직

```
입력: 코드 전체 라인 배열, 클릭한 라인 인덱스(0-based)

케이스 A: 해당 줄에 닫히지 않은 { 가 있음
  → 해당 줄부터 아래로 스캔
  → depth 카운터로 {/} 추적
  → depth가 0이 되는 줄 반환 (닫히는 줄)

케이스 B: 해당 줄이 } 만 있는 줄 (또는 줄 전체가 })
  → 해당 줄부터 위로 스캔
  → depth 카운터로 역추적
  → depth가 0이 되는 줄 반환 (열리는 줄)

케이스 C: 같은 줄에 { 와 } 가 균형 → null 반환
케이스 D: 문자열 내부 중괄호 → 무시 (isInString 추적)
```

---

## 5. 수용 기준 (Acceptance Criteria)

- [ ] `function Foo() {` 클릭 → 짝 닫는 `}` 줄 번호 표시
- [ ] `const x = () => {` 클릭 → 짝 닫는 `}` 줄 번호 표시
- [ ] `if (condition) {` 클릭 → 짝 닫는 `}` 줄 번호 표시
- [ ] 단독 `}` 줄 클릭 → 짝 여는 줄 번호 표시
- [ ] 짝 번호 클릭 시 해당 줄로 스크롤 이동
- [ ] 짝 없음(top-level `}`)은 조용히 표시 안 함
- [ ] 기존 `explainLine` 설명과 함께 표시 (대체 아님)
- [ ] 오프라인 동작 (API 없음)

---

## 6. 관련 기능

- **v0.5.0 학습 모드** (`LearnMode.tsx`) — 이 기능의 확장
- **컴포넌트 트리** (`ComponentTree.tsx`) — 별도 독립, 영향 없음

---

## 7. 버전 계획

```
v0.5.0 (완료): 학습 모드 - 줄 클릭 설명
v0.6.0 (이번):
  - function-pair-highlight (짝 라인 표시)  ← 이 기능
  - PWA 설치 지원 (선택적)
```
